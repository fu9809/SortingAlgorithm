## 快速排序（QuickSort）

### 原理

- 选择一个元素，将比他小的放在他的左边，比他大的放右边，递归完所有未完成排序的数组即可完成最后的目标。
- 快速排序是冒泡排序的改进版，也是最好的一种内排序

### 思想

1. 待排序的元素任取一个元素作为基准(通常选第一个元素，但较佳的选择方法是从待排序元素中随机选取一个作为基准，称为“枢轴”(pivot)。
2. 基于这个值，将数组分为两部分，大的元素放在它的右边，比其小的放在它的左边。
3. 可以肯定，如此一轮下来，这个枢轴的位置一定在最终位置上。
4. 对两个子数组分别递归上述过程，直到每个数组只有一个元素。
5. 排序完成。

![Sorting_quicksort_anim](assets/Sorting_quicksort_anim.gif) 

### 优点

- 相比冒泡排序，每次交换是跳跃式的。每次排序的时候设置一个基准点，将小于等于基准点的数全部放到基准点的左边，将大于等于基准点的数全部放到基准点的右边。这样在每次交换的时候就不会像冒泡排序一样每次只能在相邻的数之间进行交换，交换的距离就大的多了。因此总的比较和交换次数就少了，速度自然就提高了。

### 性能 / 复杂度

#### 性能

- 可以看出，每一次调用partition()方法都需要扫描一遍数组长度（注意，在递归的时候这个长度并不是原数组的长度n，而是被分隔出来的小数组，即n*(2\^(-i))），其中i为调用深度。而在这一层同样长度的数组有2\^i个。那么，每层排序大约需要O(n)复杂度。而一个长度为n的数组，调用深度最多为log(n)层。二者相乘，得到快速排序的平均复杂度为O(n ㏒n)。
- 通常，快速排序被认为是在所有同数量级的排序方法中，平均性能最好。

#### 时间复杂度

- 最好情况：O(nlog~2~n) 
- 最差时间复杂度和冒泡排序一样,都是O(n^2^) 
- 平均时间复杂度为O(n log~2~n)。

#### 空间复杂度

- O(log~2~n) 

### 稳定性

- 不稳定
- 这是因为我们无法保证相等的数据按顺序被扫描到和按顺序存放

### 3种实现方法：

1. 左右指针法
2. 前后指针法
   - 它最大的特点就是，左右指针法和挖坑法只能针对顺序序列进行排序，如果是对一个链表进行排序， 就无用武之地了。
3. 挖坑法

## 3种优化方法

- 详情参见
  - [最高效的快速排序分析与优化](https://blog.csdn.net/qq_39521554/article/details/79357158) 

### 1. 三数取中法

- 三数取中法（median-of-three）
- 直接拿序列的最后一个值作为枢轴，如果最后这个值刚好是整段序列最大或者最小的值，那么这次划分就是没意义的。
- 所以当序列是正序或者逆序时，每次选到的枢轴都是没有起到划分的作用。快排的效率会极速退化。
- 所以可以每次在选枢轴时，在序列的第一，中间，最后三个值里面选一个中间值出来作为枢轴，保证每次划分接近均等。
- 使用三数中值分割法消除了预排序输入的不好情形，并且减少快排大约14%的比较次数

### 2. 使用直接插入排序

- 由于是递归程序，每一次递归都要开辟栈帧，当递归到序列里的值不是很多时，我们可以采用直接插入排序来完成，从而避免这些栈帧的消耗。
- 采用 三数取中 + 插排 的方法，效果更优

### 3.  同元聚类法

- 同元聚类（same-element cluster）

- 针对已排序的数组，快速排序是没有任何用处的。因为待排序序列是已经有序的，那么每次划分只能使待排序序列减一。此时，插排也发挥不了作用。

- 另外，三数取中选择枢轴+插排 不能处理重复数组，在一次分割结束后，可以把与Key相等的元素聚在一起，继续下次分割时，不用再对与key相等元素分割

- 同元聚类

  ```
  具体过程：在处理过程中，会有两个步骤
  第一步，在划分过程中，把与key相等元素放入数组的两端
  第二步，划分结束后，把与key相等的元素移到枢轴周围
  举例：
  待排序序列 1 4 6 7 6 6 7 6 8 6
  三数取中选取枢轴：下标为4的数6
  转换后，待分割序列：6 4 6 7 1 6 7 6 8 6
               枢轴key：6
  
  第一步，在划分过程中，把与key相等元素放入数组的两端
  结果为：6 4 1 6(枢轴) 7 8 7 6 6 6，  此时，与6相等的元素全放入在两端了
  第二步，划分结束后，把与key相等的元素移到枢轴周围
  
  结果为：1 4 66(枢轴)  6 6 6 7 8 7，此时，与6相等的元素全移到枢轴周围了。之后，在1 4 和 7 8 7两个子序列进行快排
  ```

  
